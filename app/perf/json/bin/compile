#!/bin/bash

mkdir -p exe

# Go
if [ $# -eq 0 ] || [[ $1 == "go" ]]; then
  echo -n "Go"
  cd src/go
  go build main.go && mv main ../../exe/go
  cd - > /dev/null
  echo " done"
fi

# Ion
if [ $# -eq 0 ] || [[ $1 == "ion" ]]; then
  echo -n "Ion"
  cd ../../../
  gcc app/perf/json/src/ion/main.c  \
    -no-integrated-cpp -B ./bin     \
    -std=c11 -Wall -Werror          \
    -D PLATFORM=LINUX               \
    -I ./src                        \
    -I ./ion                        \
    -O3 -march=native               \
    -o app/perf/json/exe/ion
  cd - > /dev/null
  echo " done"
fi

# Python
if [ $# -eq 0 ] || [[ $1 == "python" ]]; then
  echo -n "Python"
  rm -rf exe/python
  echo "#!/bin/bash" >> exe/python
  echo "python3 src/python/main.py" >> exe/python
  chmod +x exe/python
  echo " done"
fi

# Ruby
if [ $# -eq 0 ] || [[ $1 == "ruby" ]]; then
  echo -n "Ruby"
  rm -rf exe/ruby
  echo "#!/bin/bash" >> exe/ruby
  echo "ruby src/ruby/main.rb" >> exe/ruby
  chmod +x exe/ruby
  echo " done"
fi

# Rust
if [ $# -eq 0 ] || [[ $1 == "rust" ]]; then
  echo -n "Rust"
  cd src/rust
  cargo build --release 2> /dev/null
  mv target/release/main ../../exe/rust
  rm -rf target
  cd - > /dev/null
  echo " done"
fi

# SimdJSON
if [ $# -eq 0 ] || [[ $1 == "simdjson" ]]; then
  echo -n "SIMDJSON"
  cd src/simdjson
  g++ main.cpp lib/simdjson.cpp \
    -std=c++20                  \
    -O3 -march=native           \
    -o ../../exe/simdjson
  cd - > /dev/null
  echo " done"
fi
